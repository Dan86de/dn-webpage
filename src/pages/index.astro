---
import Layout from "@/layouts/Layout.astro";
import VaillantLogo from "@/images/vaillant_logo.svg";
import BechtleLogo from "@/images/bechtle_logo.svg";
import CodeIcon from "@/images/icons/code.svg";
import ReactIcon from "@/images/icons/react.svg";
import NextJSIcon from "@/images/icons/nextjs.svg";
import VercelIcon from "@/images/icons/vercel.svg";
import TypeScriptIcon from "@/images/icons/ts.svg";
import JavaScriptIcon from "@/images/icons/js.svg";
import NodeJsIcon from "@/images/icons/nodejs.svg";
import BunIcon from "@/images/icons/bun.svg";
import TailwindCSSIcon from "@/images/icons/tailwindcss.svg";
import ShadCnUIIcon from "@/images/icons/shadcnui.svg";
import RadixUIIcon from "@/images/icons/radixui.svg";
import MotionIcon from "@/images/icons/motion.svg";
import TanstackIcon from "@/images/icons/tanstack.svg";
import WorkExperience from "@/components/experience/WorkExperience.astro";
import Position from "@/components/experience/Position.astro";
import PixelCard from "@/components/PixelCard.astro";
import Sidebar from "@/components/Sidebar.astro";
import Stack from "@/components/Stack.astro";
---

<Layout>
  <div class="px-(--inline-padding) h-[200vh]">
    <Sidebar
      class="mx-auto max-w-4xl laptop:[--sidebar-width:var(--container-2xl)] laptop:[--sidebar-content-min:100px] laptop:[--sidebar-gap:4rem]"
    >
      <div>
        <h2 class="font-medium pb-10" id="experience">Experience</h2>
        <!-- Vaillant -->
        <div class="max-w-3xl border-b border-b-grey-200 mb-3">
          <WorkExperience companyName="Vaillant Group" isCurrentJob={true}>
            <VaillantLogo width={24} height={32} slot="logo" />
            <Position
              slot="positions"
              title="React Native Developer"
              employmentType="Full-Time"
              startDate="05-2024"
              endDate="now"
            >
              <CodeIcon width={18} slot="icon" />
              <div class="pl-8 pb-4" slot="description">
                <ul class="list-disc pl-5 text-grey-800 text-sm">
                  <li>Develop Web and Native myVaillant PRO App.</li>
                  <li>
                    Cooperate with business and design in creating new features.
                  </li>
                  <li>
                    Analyze technical capabilities and provide optimal
                    solutions.
                  </li>
                  <li>Ensure UI/UX consistency and adherence to standards.</li>
                </ul>
              </div>
            </Position>
          </WorkExperience>
        </div>

        <!-- Bechtle -->
        <div class="max-w-3xl border-b border-b-grey-200 mb-8">
          <WorkExperience companyName="Bechtle / AV360" isCurrentJob={false}>
            <BechtleLogo width={24} height={32} slot="logo" />
            <Position
              slot="positions"
              title="Software Developer"
              employmentType="Full-Time"
              startDate="12-2020"
              endDate="05-2024"
            >
              <CodeIcon width={18} slot="icon" />
              <div class="pl-8 pb-4" slot="description">
                <p class="text-grey-800 underline pb-2 text-sm">
                  Develop interface for document management platform
                </p>
                <ul class="list-disc pl-5 text-grey-800 pb-3 text-sm">
                  <li>
                    Developed interface for a document management platform using
                    ReactJS, FluentUI, and TypeScript.
                  </li>
                  <li>
                    Designed and applied a testing strategy with Jest and
                    snapshot tests to improve software reliability.
                  </li>
                  <li>
                    Devised and executed more effective solutions for large data
                    tables using infinite scrolling and pagination.
                  </li>
                  <li>
                    Collaborated closely with UI/UX Design Team to enhance
                    interface usability and aesthetics.
                  </li>
                </ul>
                <p class="text-grey-800 underline pb-2 text-sm">
                  Ideated and implemented a multi-platform chat messaging app in
                  Tauri, boosting the company’s product portfolio and revenue
                </p>
                <ul class="list-disc pl-5 text-grey-800 text-sm pb-4">
                  <li>
                    Constructed interfaces and logic for system management and
                    chat messaging applications.
                  </li>
                  <li>
                    Incorporated the open-source Matrix Protocol for enhanced
                    communication capabilities.
                  </li>
                  <li>
                    Created an advanced editor using the Lexical Framework,
                    contributing to the expansion of the company’s software
                    capabilities.
                  </li>
                  <li>
                    Implemented CI/CD pipeline on Azure for Tauri and Rust,
                    streamlining the development and deployment process.
                  </li>
                </ul>
                <p class="max-w-3xl text-grey-800 text-sm font-medium">
                  Throughout my tenure, I have successfully tackled complex
                  challenges, innovated solutions, and developed impactful
                  software. My contributions have played a key role in enhancing
                  product quality and user experience, ultimately leading to
                  increased customer satisfaction and revenue growth for the
                  company.
                </p>
              </div>
            </Position>
          </WorkExperience>
        </div>

        <h2 class="font-medium pb-6" id="stack">Stack</h2>
        <div class="cluster max-w-3xl" style={{ "--cluster-space": "0" }}>
          <PixelCard
            variant="react"
            className="w-1/4 tablet:w-1/6 h-auto aspect-square laptop:w-1/6 desktop:w-1/8 hover:z-10"
          >
            <div class="flex items-center flex-col gap-2 z-10">
              <ReactIcon class="dark:text-[#58C4DC] text-[#087EA4] size-8" />
            </div>
          </PixelCard>
          <PixelCard
            variant="ts"
            className="w-1/4 tablet:w-1/6 h-auto aspect-square laptop:w-1/6 desktop:w-1/8 hover:z-10"
          >
            <div class="flex items-center flex-col gap-2 z-10">
              <TypeScriptIcon class="text-[#3178C6] size-8" />
            </div>
          </PixelCard>
          <PixelCard
            variant="default"
            className="w-1/4 tablet:w-1/6 h-auto aspect-square laptop:w-1/6 desktop:w-1/8 hover:z-10"
          >
            <div class="flex items-center flex-col gap-2 z-10">
              <NextJSIcon class="text-grey-950 size-10" />
            </div>
          </PixelCard>
          <PixelCard
            variant="default"
            className="w-1/4 tablet:w-1/6 h-auto aspect-square laptop:w-1/6 desktop:w-1/8 hover:z-10"
          >
            <div class="flex items-center flex-col gap-2 z-10">
              <VercelIcon class="text-grey-950 size-8" />
            </div>
          </PixelCard>
          <PixelCard
            variant="js"
            className="w-1/4 tablet:w-1/6 h-auto aspect-square laptop:w-1/6 desktop:w-1/8 hover:z-10"
          >
            <div class="flex items-center flex-col gap-2 z-10">
              <JavaScriptIcon class="text-[#f7df1e] size-8" />
            </div>
          </PixelCard>
          <PixelCard
            variant="nodejs"
            className="w-1/4 tablet:w-1/6 h-auto aspect-square laptop:w-1/6 desktop:w-1/8 hover:z-10"
          >
            <div class="flex items-center flex-col gap-2 z-10">
              <NodeJsIcon class="size-8" />
            </div>
          </PixelCard>
          <PixelCard
            variant="bun"
            className="w-1/4 tablet:w-1/6 h-auto aspect-square laptop:w-1/6 desktop:w-1/8 hover:z-10"
          >
            <div class="flex items-center flex-col gap-2 z-10">
              <BunIcon class="size-8" />
            </div>
          </PixelCard>
          <PixelCard
            variant="tailwindcss"
            className="w-1/4 tablet:w-1/6 h-auto aspect-square laptop:w-1/6 desktop:w-1/8 hover:z-10"
          >
            <div class="flex items-center flex-col gap-2 z-10">
              <TailwindCSSIcon class="size-8" />
            </div>
          </PixelCard>
          <PixelCard
            variant="default"
            className="w-1/4 tablet:w-1/6 h-auto aspect-square laptop:w-1/6 desktop:w-1/8 hover:z-10"
          >
            <div class="flex items-center flex-col gap-2 z-10">
              <ShadCnUIIcon class="size-8" />
            </div>
          </PixelCard>
          <PixelCard
            variant="default"
            className="w-1/4 tablet:w-1/6 h-auto aspect-square laptop:w-1/6 desktop:w-1/8 hover:z-10"
          >
            <div class="flex items-center flex-col gap-2 z-10">
              <RadixUIIcon class="size-8" />
            </div>
          </PixelCard>
          <PixelCard
            variant="motion"
            className="w-1/4 tablet:w-1/6 h-auto aspect-square laptop:w-1/6 desktop:w-1/8 hover:z-10"
          >
            <div class="flex items-center flex-col gap-2 z-10">
              <MotionIcon class="size-10" />
            </div>
          </PixelCard>
          <PixelCard
            variant="tanstack"
            className="w-1/4 tablet:w-1/6 h-auto aspect-square laptop:w-1/6 desktop:w-1/8 hover:z-10"
          >
            <div class="flex items-center flex-col gap-2 z-10">
              <TanstackIcon class="size-8" />
            </div>
          </PixelCard>
        </div>

        <!-- <h2 class="font-medium pb-6" id="blog">Blog</h2>
        <h2 class="font-medium pb-6" id="certifications">Certifications</h2> -->
      </div>
      <div class="hidden desktop:block mt-49 relative">
        <div class="sticky top-20">
          <p class="caption pb-4">Table of contents</p>
          <ul id="toc-list" class="flex flex-col gap-1">
            <li
              data-section="experience"
              class="toc-item footnote cursor-pointer flex gap-2 items-center -ml-4 transition-colors"
            >
              <span
                class="toc-indicator block size-2 bg-orange-500 rounded-full opacity-0 transition-opacity"
              ></span><a href="#experience">Experience</a>
            </li>
            <li
              data-section="stack"
              class="toc-item footnote cursor-pointer flex gap-2 items-center -ml-4 transition-colors"
            >
              <span
                class="toc-indicator block size-2 bg-orange-500 rounded-full opacity-0 transition-opacity"
              ></span><a href="#stack">Stack</a>
            </li>
            <!-- <li
              data-section="blog"
              class="toc-item footnote cursor-pointer flex gap-2 items-center -ml-4 transition-colors"
            >
              <span
                class="toc-indicator block size-2 bg-orange-500 rounded-full opacity-0 transition-opacity"
              ></span><a href="#blog">Blog</a>
            </li>
            <li
              data-section="certifications"
              class="toc-item footnote cursor-pointer flex gap-2 items-center -ml-4 transition-colors"
            >
              <span
                class="toc-indicator block size-2 bg-orange-500 rounded-full opacity-0 transition-opacity"
              ></span><a href="#certifications">Certifications</a>
            </li> -->
          </ul>
        </div>
      </div>
    </Sidebar>
  </div>
</Layout>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const sections = document.querySelectorAll(
      "h1[id], h2[id], h3[id], h4[id]",
    );
    const tocItems = document.querySelectorAll(".toc-item");

    // Function to update active TOC item
    function updateActiveSection() {
      const scrollPosition = window.scrollY + 100; // Offset for better UX

      let activeSection: string | null = null;

      // Find which section is currently in view
      sections.forEach((section) => {
        const rect = section.getBoundingClientRect();
        const sectionTop = rect.top + window.scrollY;

        if (scrollPosition >= sectionTop) {
          activeSection = section.id;
        }
      });

      // Update TOC styling
      tocItems.forEach((item) => {
        const sectionId = item.getAttribute("data-section");
        const indicator = item.querySelector(".toc-indicator");
        const link = item.querySelector("a");

        if (sectionId === activeSection) {
          // Active state
          item.classList.add("text-orange-500");
          item.classList.remove("text-current");
          if (indicator) {
            indicator.classList.remove("opacity-0");
            indicator.classList.add("opacity-100");
          }
        } else {
          // Inactive state
          item.classList.remove("text-orange-500");
          item.classList.add("text-current");
          if (indicator) {
            indicator.classList.add("opacity-0");
            indicator.classList.remove("opacity-100");
          }
        }
      });
    }

    // Add smooth scrolling for TOC links
    tocItems.forEach((item) => {
      const link = item.querySelector("a");
      if (link) {
        link.addEventListener("click", (e) => {
          e.preventDefault();
          const targetId = link.getAttribute("href")?.substring(1);
          const targetSection = document.getElementById(targetId ?? "");

          if (targetSection) {
            const offset = 80; // Adjust this value based on your header height
            const targetPosition =
              targetSection.getBoundingClientRect().top +
              window.scrollY -
              offset;

            window.scrollTo({
              top: targetPosition,
              behavior: "smooth",
            });
          }
        });
      }
    });

    // Use Intersection Observer for better performance
    const observerOptions = {
      rootMargin: "-20% 0% -70% 0%",
      threshold: 0,
    };

    const observer = new IntersectionObserver((entries) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) {
          const sectionId = entry.target.id;

          // Update TOC styling
          tocItems.forEach((item) => {
            const itemSectionId = item.getAttribute("data-section");
            const indicator = item.querySelector(".toc-indicator");

            if (itemSectionId === sectionId) {
              item.classList.add("text-orange-500");
              item.classList.remove("text-current");
              if (indicator) {
                indicator.classList.remove("opacity-0");
                indicator.classList.add("opacity-100");
              }
            } else {
              item.classList.remove("text-orange-500");
              item.classList.add("text-current");
              if (indicator) {
                indicator.classList.add("opacity-0");
                indicator.classList.remove("opacity-100");
              }
            }
          });
        }
      });
    }, observerOptions);

    // Observe all sections
    sections.forEach((section) => {
      observer.observe(section);
    });

    // Initial check
    updateActiveSection();

    // Fallback scroll listener for edge cases
    let scrollTimeout: NodeJS.Timeout;
    window.addEventListener("scroll", () => {
      clearTimeout(scrollTimeout);
      scrollTimeout = setTimeout(updateActiveSection, 10);
    });
  });
</script>
