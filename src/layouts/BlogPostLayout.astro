---
import Layout from "./Layout.astro";
import TableOfContents from "@/components/TableOfContents.astro";
import SEO from "@/components/SEO.astro";
import Sidebar from "@/components/Sidebar.astro";
import type { TocItem } from "@/lib/toc";

interface Props {
  title: string;
  description: string;
  author: string;
  publishDate: Date;
  readingTime: string;
  tags: string[];
  toc: TocItem[];
  canonicalURL: string;
  image?: string;
  imageAlt?: string;
}

const {
  title,
  description,
  author,
  publishDate,
  readingTime,
  tags,
  toc,
  canonicalURL,
  image,
  imageAlt,
} = Astro.props;

// Format date as "Jan 19, 2026"
const formattedDate = publishDate.toLocaleDateString("en-US", {
  year: "numeric",
  month: "short",
  day: "numeric",
});
---

<Layout>
  <SEO
    slot="head"
    title={title}
    description={description}
    canonicalURL={canonicalURL}
    image={image}
    imageAlt={imageAlt}
    publishDate={publishDate}
    author={author}
    tags={tags}
    type="article"
  />
  <div class="px-(--inline-padding) pb-[100vh]">
    <Sidebar
      class="mx-auto max-w-4xl laptop:[--sidebar-width:var(--container-2xl)] laptop:[--sidebar-content-min:100px] laptop:[--sidebar-gap:4rem]"
    >
      <!-- CONTENT -->
      <article>
        <!-- Post header with metadata -->
        <header class="pb-8 mt-10">
          <h1
            class="bg-brand-gradient bg-clip-text text-transparent font-medium pb-4"
          >
            {title}
          </h1>
          <div class="text-sm text-gray-600 dark:text-gray-400 space-y-1">
            <div>
              <span>{formattedDate}</span>
              <span class="mx-2">Â·</span>
              <span>{readingTime}</span>
            </div>
            {
              tags.length > 0 && (
                <div class="flex flex-wrap gap-2 pt-2">
                  {tags.map((tag) => (
                    <span class="px-2 py-1 text-xs rounded-md bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300">
                      {tag}
                    </span>
                  ))}
                </div>
              )
            }
          </div>
        </header>

        <!-- MDX content with prose styling -->
        <slot />
      </article>

      <!-- TOC -->
      <div class="hidden desktop:block mt-49 relative">
        <TableOfContents toc={toc} />
      </div>
    </Sidebar>
  </div>
</Layout>
