---
import Layout from "./Layout.astro";
import TableOfContents from "@/components/TableOfContents.astro";
import SEO from "@/components/SEO.astro";
import type { TocItem } from "@/lib/toc";

interface Props {
  title: string;
  description: string;
  author: string;
  publishDate: Date;
  readingTime: string;
  tags: string[];
  toc: TocItem[];
  canonicalURL: string;
  image?: string;
  imageAlt?: string;
}

const {
  title,
  description,
  author,
  publishDate,
  readingTime,
  tags,
  toc,
  canonicalURL,
  image,
  imageAlt,
} = Astro.props;

// Format date as "Jan 19, 2026"
const formattedDate = publishDate.toLocaleDateString("en-US", {
  year: "numeric",
  month: "short",
  day: "numeric",
});
---

<Layout>
  <SEO
    slot="head"
    title={title}
    description={description}
    canonicalURL={canonicalURL}
    image={image}
    imageAlt={imageAlt}
    publishDate={publishDate}
    author={author}
    tags={tags}
    type="article"
  />
  <div class="px-(--inline-padding)">
    <div class="max-w-7xl mx-auto">
      <!-- Two column layout: main content + TOC sidebar -->
      <div class="grid grid-cols-1 laptop:grid-cols-[1fr_250px] gap-8">
        <!-- Main content column -->
        <article class="max-w-3xl">
          <!-- Post header with metadata -->
          <header class="pb-8 mt-10">
            <h2
              class="bg-brand-gradient bg-clip-text text-transparent font-medium pb-4"
            >
              {title}
            </h2>
            <div class="text-sm text-gray-600 dark:text-gray-400 space-y-1">
              <div>
                <span>{author}</span>
                <span class="mx-2">·</span>
                <span>{formattedDate}</span>
                <span class="mx-2">·</span>
                <span>{readingTime}</span>
              </div>
              {
                tags.length > 0 && (
                  <div class="flex flex-wrap gap-2 pt-2">
                    {tags.map((tag) => (
                      <span class="px-2 py-1 text-xs rounded-md bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300">
                        {tag}
                      </span>
                    ))}
                  </div>
                )
              }
            </div>
          </header>

          <!-- MDX content with prose styling -->
          <div class="prose dark:prose-invert prose-headings:scroll-mt-20 max-w-none">
            <slot />
          </div>
        </article>

        <!-- TOC sidebar (hidden on mobile, sticky on desktop) -->
        <aside class="hidden laptop:block">
          <TableOfContents toc={toc} />
        </aside>
      </div>
    </div>
  </div>
</Layout>
