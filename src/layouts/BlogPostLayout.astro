---
import Layout from "./Layout.astro";
import TableOfContents from "@/components/TableOfContents.astro";
import SEO from "@/components/SEO.astro";
import Sidebar from "@/components/Sidebar.astro";
import type { TocItem } from "@/lib/toc";

interface Props {
  title: string;
  description: string;
  author: string;
  publishDate: Date;
  readingTime: string;
  tags: string[];
  toc: TocItem[];
  canonicalURL: string;
  image?: string;
  imageAlt?: string;
}

const {
  title,
  description,
  author,
  publishDate,
  readingTime,
  tags,
  toc,
  canonicalURL,
  image,
  imageAlt,
} = Astro.props;

// Format date as "Jan 19, 2026"
const formattedDate = publishDate.toLocaleDateString("en-US", {
  year: "numeric",
  month: "short",
  day: "numeric",
});
---

<Layout>
  <SEO
    slot="head"
    title={title}
    description={description}
    canonicalURL={canonicalURL}
    image={image}
    imageAlt={imageAlt}
    publishDate={publishDate}
    author={author}
    tags={tags}
    type="article"
  />
  <div class="px-(--inline-padding) pb-[100vh]">
    <Sidebar
      class="mx-auto max-w-4xl laptop:[--sidebar-width:var(--container-2xl)] laptop:[--sidebar-content-min:100px] laptop:[--sidebar-gap:4rem]"
    >
      <!-- CONTENT -->
      <article>
        <!-- Post header with metadata -->
        <header class="pb-8 mt-10">
          <h1
            class="bg-brand-gradient bg-clip-text text-transparent font-medium pb-4"
          >
            {title}
          </h1>
          <div class="text-sm text-gray-600 dark:text-gray-400 space-y-1">
            <div>
              <span>{formattedDate}</span>
              <span class="mx-2">Â·</span>
              <span>{readingTime}</span>
            </div>
            {
              tags.length > 0 && (
                <div class="flex flex-wrap gap-2 pt-2">
                  {tags.map((tag) => (
                    <span class="px-2 py-1 text-xs rounded-md bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300">
                      {tag}
                    </span>
                  ))}
                </div>
              )
            }
          </div>
        </header>

        <!-- MDX content with prose styling -->
        <div class="mdx-content">
          <slot />
        </div>
      </article>

      <!-- TOC -->
      <div class="hidden desktop:block mt-49 relative">
        <TableOfContents toc={toc} />
      </div>
    </Sidebar>
  </div>
</Layout>

<style is:global>
  /* MDX content styling to match about page */
  .mdx-content {
    /* Base text styling */
    & p {
      margin-bottom: calc(var(--spacing) * 6); /* pb-6 */
    }

    /* Heading styles matching about page */
    & h1,
    & h2,
    & h3,
    & h4 {
      font-weight: 500; /* font-medium */
      max-width: 675px;
      padding-bottom: calc(var(--spacing) * 6); /* pb-6 */
    }

    /* Lists */
    & ul,
    & ol {
      margin-bottom: calc(var(--spacing) * 6);
      padding-left: calc(var(--spacing) * 6);
    }

    & li {
      margin-bottom: calc(var(--spacing) * 2);
    }

    /* Code blocks */
    & pre {
      margin-bottom: calc(var(--spacing) * 6);
      padding: calc(var(--spacing) * 4);
      border-radius: 0.5rem;
      overflow-x: auto;
    }

    /* Inline code */
    & code:not(pre code) {
      background-color: oklch(92.3% 0.001082 17.2);
      padding: 0.125rem 0.375rem;
      border-radius: 0.25rem;
      font-size: 0.9em;
    }

    .dark & code:not(pre code) {
      background-color: oklch(21.5% 0.001566 17.3);
    }

    /* Blockquotes */
    & blockquote {
      border-left: 4px solid var(--color-orange-500);
      padding-left: calc(var(--spacing) * 4);
      margin-bottom: calc(var(--spacing) * 6);
      font-style: italic;
      color: var(--color-grey-800);
    }

    .dark & blockquote {
      color: var(--color-grey-800);
    }

    /* Links */
    & a {
      color: var(--color-orange-500);
      text-decoration: underline;
      text-decoration-color: var(--color-orange-300);
      text-underline-offset: 2px;
      transition: text-decoration-color 0.2s;
    }

    & a:hover {
      text-decoration-color: var(--color-orange-500);
    }

    /* Custom MDX components */
    & .callout,
    & .code-demo,
    & .figure,
    & .youtube {
      margin-bottom: calc(var(--spacing) * 8); /* pb-8 */
    }

    /* Remove bottom margin from last child */
    & > *:last-child {
      margin-bottom: 0;
    }
  }
</style>
