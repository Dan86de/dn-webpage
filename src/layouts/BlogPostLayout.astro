---
import Layout from "./Layout.astro";
import TableOfContents from "@/components/TableOfContents.astro";
import SEO from "@/components/SEO.astro";
import Sidebar from "@/components/Sidebar.astro";
import type { TocItem } from "@/lib/toc";
import { cn } from "@/lib/utils";

interface Props {
  title: string;
  description: string;
  author: string;
  publishDate: Date;
  readingTime: string;
  tags: string[];
  toc: TocItem[];
  canonicalURL: string;
  image?: string;
  imageAlt?: string;
}

const {
  title,
  description,
  author,
  publishDate,
  readingTime,
  tags,
  toc,
  canonicalURL,
  image,
  imageAlt,
} = Astro.props;

// Format date as "Jan 19, 2026"
const formattedDate = publishDate.toLocaleDateString("en-US", {
  year: "numeric",
  month: "short",
  day: "numeric",
});
---

<Layout>
  <SEO
    slot="head"
    title={title}
    description={description}
    canonicalURL={canonicalURL}
    image={image}
    imageAlt={imageAlt}
    publishDate={publishDate}
    author={author}
    tags={tags}
    type="article"
  />
  <div class="px-(--inline-padding) pb-[100vh]">
    <Sidebar
      class={cn(
      "mx-auto max-w-4xl",
      "tablet:[--sidebar-width:var(--container-2xl)]",
      "tablet:[--sidebar-content-min:100px]",
      "tablet:[--sidebar-gap:4rem]")}
    >

      <!-- CONTENT -->
      <article class="max-w-xl">

        <!-- Post header with metadata -->
        <header class="pb-8 mt-10">
          <h1
            class="bg-brand-gradient bg-clip-text text-transparent font-medium pb-4"
          >
            {title}
          </h1>
          <div class="text-sm space-y-1">
            <div>
              <span>{formattedDate}</span>
              <span class="mx-2">Â·</span>
              <span>{readingTime}</span>
            </div>
            {
              tags.length > 0 && (
                <div class="flex flex-wrap gap-1 pt-2">
                  {tags.map((tag) => (
                    <span class="px-0.5 py-1 text-xs rounded-md bg-gray-100 text-grey-500">
                      {tag}
                    </span>
                  ))}
                </div>
              )
            }
          </div>
        </header>
        <div class="laptop:hidden relative py-4 border-y border-orange-600">
          <TableOfContents toc={toc} />
        </div>
        <!-- MDX content with prose styling -->
        <div class="mdx-content mt-8 laptop:mt-0">
          <slot />
        </div>
      </article>

      <!-- TOC -->
      <div class="hidden laptop:block mt-49 relative">
        <TableOfContents toc={toc} />
      </div>
    </Sidebar>
  </div>
</Layout>

<style is:global>
  /* MDX content styling to match about page */
  .mdx-content {
    /* Base text styling */
    & p {
      margin-bottom: calc(var(--spacing) * 6); /* pb-6 */
    }

    & strong {
      font-weight: 500; /* font-semibold */
    }

    /* Heading styles for blog posts */
    & h1 {
      font-weight: 500;
      max-width: 675px;
      padding-bottom: calc(var(--spacing) * 6); /* pb-6 */
    }

    & h2 {
      font-weight: 500;
      max-width: 675px;
      padding-bottom: calc(var(--spacing) * 6); /* pb-6 */
      font-size: var(--text-xl); /* 20px - same as h3 mobile */
      line-height: calc(var(--spacing) * 6); /* 24px */
    }

    & h3 {
      font-weight: 500;
      max-width: 675px;
      padding-bottom: calc(var(--spacing) * 6); /* pb-6 */
      font-size: var(--text-lg); /* 18px */
      line-height: calc(var(--spacing) * 5.5); /* 22px */
    }

    & h4 {
      font-weight: 500;
      max-width: 675px;
      padding-bottom: calc(var(--spacing) * 6); /* pb-6 */
      font-size: var(--text-base); /* 16px */
      line-height: calc(var(--spacing) * 5); /* 20px */
    }

    /* Tablet and up */
    @media (min-width: 550px) {
      & h2 {
        font-size: var(--text-2xl); /* 24px - same as old h3 tablet */
        line-height: calc(var(--spacing) * 7); /* 28px */
      }

      & h3 {
        font-size: var(--text-xl); /* 20px */
        line-height: calc(var(--spacing) * 6); /* 24px */
      }

      & h4 {
        font-size: var(--text-lg); /* 18px */
        line-height: calc(var(--spacing) * 5.5); /* 22px */
      }
    }

    /* Desktop and up */
    @media (min-width: 1500px) {
      & h2 {
        font-size: var(--text-3xl); /* 30px - same as old h3 desktop */
        line-height: calc(var(--spacing) * 8.5); /* 34px */
      }

      & h3 {
        font-size: var(--text-2xl); /* 24px */
        line-height: calc(var(--spacing) * 7); /* 28px */
      }

      & h4 {
        font-size: var(--text-xl); /* 20px */
        line-height: calc(var(--spacing) * 6); /* 24px */
      }
    }

    /* Lists */
    & ul,
    & ol {
      margin-bottom: calc(var(--spacing) * 6);
      padding-left: calc(var(--spacing) * 6);
    }

    & li {
      margin-bottom: calc(var(--spacing) * 2);
    }

    /* Code blocks */
    & pre {
      margin-bottom: calc(var(--spacing) * 6);
      padding: calc(var(--spacing) * 4);
      border-radius: 0.5rem;
      overflow-x: auto;
    }

    /* Inline code */
    & code:not(pre code) {
      background-color: oklch(92.3% 0.001082 17.2);
      padding: 0.125rem 0.375rem;
      border-radius: 0.25rem;
      font-size: 0.9em;
    }

    .dark & code:not(pre code) {
      background-color: oklch(21.5% 0.001566 17.3);
    }

    /* Blockquotes */
    & blockquote {
      border-left: 4px solid var(--color-orange-500);
      padding-left: calc(var(--spacing) * 4);
      margin-bottom: calc(var(--spacing) * 6);
      font-style: italic;
      color: var(--color-gray-800);
    }

    .dark & blockquote {
      color: var(--color-gray-800);
    }

    /* Links */
    & a {
      color: var(--color-orange-500);
      text-decoration: underline;
      text-decoration-color: var(--color-orange-300);
      text-underline-offset: 2px;
      transition: text-decoration-color 0.2s;
    }

    & a:hover {
      text-decoration-color: var(--color-orange-500);
    }

    /* Custom MDX components */
    & .callout,
    & .code-demo,
    & .figure,
    & .youtube {
      margin-bottom: calc(var(--spacing) * 8); /* pb-8 */
    }

    /* Remove bottom margin from last child */
    & > *:last-child {
      margin-bottom: 0;
    }
  }
</style>
