---
import { type PositionProps } from "./types";
type Props = PositionProps;
const { title, employmentType, startDate, endDate, defaultOpen } = Astro.props;
---

<script>
  // Calculate and set actual heights for smoother animations
  document.addEventListener("DOMContentLoaded", () => {
    const details = document.querySelectorAll("details");

    details.forEach((detail) => {
      const content = detail.querySelector(".accordion-content") as HTMLElement;
      const inner = detail.querySelector(".accordion-inner") as HTMLElement;

      if (content && inner) {
        // Store the actual height
        detail.addEventListener("toggle", () => {
          if (detail.open) {
            // Calculate actual height
            content.style.maxHeight = inner.scrollHeight + "px";
          } else {
            // Force a reflow to ensure animation works
            content.offsetHeight; // This forces a reflow
            content.style.maxHeight = "0";
          }
        });

        // Set initial state
        if (!detail.open) {
          content.style.maxHeight = "0";
        }
      }
    });
  });
</script>

<style>
  /* Reset default details styling */
  details {
    will-change: height;
  }

  /* Content wrapper animation with hardware acceleration */
  details .accordion-content {
    overflow: hidden;
    max-height: 0;
    opacity: 0;
    transform: translateZ(0); /* Force GPU acceleration */
    backface-visibility: hidden; /* Prevent flickering */
    perspective: 1000px; /* Create 3D rendering context */
    transition:
      max-height 300ms cubic-bezier(0.4, 0, 0.2, 1),
      opacity 200ms ease-out;
  }

  /* Open state */
  details[open] .accordion-content {
    max-height: 1000px;
    opacity: 1;
  }

  /* Inner content with anti-flicker properties */
  details .accordion-inner {
    transform: translate3d(0, -10px, 0); /* Use 3D transform */
    backface-visibility: hidden;
    transition: transform 200ms ease-out;
    will-change: transform;
  }

  details[open] .accordion-inner {
    transform: translate3d(0, 0, 0);
  }

  /* Summary hover effects */
  details summary {
    transition:
      color 200ms,
      background-color 200ms;
  }
</style>
<details class="group" open={defaultOpen ? true : false}>
  <summary
    class="flex cursor-pointer list-none items-center justify-between py-4 font-semibold transition-colors hover:bg-gray-50 [&::-webkit-details-marker]:hidden focus-visible:ring-2 focus-visible:ring-orange-500 focus-visible:ring-offset-2 focus-visible:outline-none rounded-sm"
  >
    <div>
      <div class="flex items-center gap-3">
        <div
          class="flex items-center justify-center bg-orange-100 text-orange-800 rounded-lg size-6"
        >
          <slot name="icon" />
        </div>
        <p class="body-large">{title}</p>
      </div>
      <div class="pl-9 text-gray-1100">
        <p>{`${employmentType} ${startDate} - ${endDate}`}</p>
      </div>
    </div>
    <div class="ml-6 flex shrink-0 items-center">
      <svg
        class="size-5 transition-transform duration-200 group-open:rotate-180"
        xmlns="http://www.w3.org/2000/svg"
        fill="none"
        viewBox="0 0 24 24"
        stroke="currentColor"
        stroke-width="2"
      >
        <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"
        ></path>
      </svg>
    </div>
  </summary>
  <div class="accordion-content">
    <div class="accordion-inner">
      <slot name="description" />
    </div>
  </div>
</details>
