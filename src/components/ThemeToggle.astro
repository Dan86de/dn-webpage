---

---

<button
  id="theme-toggle"
  type="button"
  class="relative flex items-center justify-center w-10 h-10 rounded-md transition-colors duration-200"
  aria-label="Toggle theme"
>
  <svg
    width="24"
    height="24"
    fill="none"
    viewBox="0 0 24 24"
    id="sun-icon"
    class="absolute w-5 h-5 transition-all duration-300"
    fill="none"
    viewBox="0 0 24 24"
    stroke="currentColor"
  >
    <circle
      cx="12"
      cy="12"
      r="3.25"
      stroke="currentColor"
      stroke-linecap="round"
      stroke-linejoin="round"
      stroke-width="1.5"></circle>
    <path
      stroke="currentColor"
      stroke-linecap="round"
      stroke-linejoin="round"
      stroke-width="1.5"
      d="M12 2.75V4.25"></path>
    <path
      stroke="currentColor"
      stroke-linecap="round"
      stroke-linejoin="round"
      stroke-width="1.5"
      d="M17.25 6.75L16.0659 7.93416"></path>
    <path
      stroke="currentColor"
      stroke-linecap="round"
      stroke-linejoin="round"
      stroke-width="1.5"
      d="M21.25 12.0001L19.75 12.0001"></path>
    <path
      stroke="currentColor"
      stroke-linecap="round"
      stroke-linejoin="round"
      stroke-width="1.5"
      d="M17.25 17.2501L16.0659 16.066"></path>
    <path
      stroke="currentColor"
      stroke-linecap="round"
      stroke-linejoin="round"
      stroke-width="1.5"
      d="M12 19.75V21.25"></path>
    <path
      stroke="currentColor"
      stroke-linecap="round"
      stroke-linejoin="round"
      stroke-width="1.5"
      d="M7.9341 16.0659L6.74996 17.25"></path>
    <path
      stroke="currentColor"
      stroke-linecap="round"
      stroke-linejoin="round"
      stroke-width="1.5"
      d="M4.25 12.0001L2.75 12.0001"></path>
    <path
      stroke="currentColor"
      stroke-linecap="round"
      stroke-linejoin="round"
      stroke-width="1.5"
      d="M7.93405 7.93423L6.74991 6.75003"></path>
  </svg>

  <svg
    id="moon-icon"
    class="absolute w-5 h-5 transition-all duration-300"
    fill="none"
    width="24"
    height="24"
    viewBox="0 0 24 24"
    fill="none"
    xmlns="http://www.w3.org/2000/svg"
  >
    <path
      d="M18.25 15.0314C17.7575 15.1436 17.2459 15.2027 16.7209 15.2027C12.8082 15.2027 9.63607 11.9185 9.63607 7.86709C9.63607 6.75253 9.87614 5.69603 10.3057 4.75C7.12795 5.47387 4.75 8.40659 4.75 11.9143C4.75 15.9657 7.9221 19.25 11.8348 19.25C14.6711 19.25 17.1182 17.5242 18.25 15.0314Z"
      stroke="currentColor"
      stroke-width="1.5"
      stroke-linecap="round"
      stroke-linejoin="round"></path>
  </svg>
</button>

<script>
  // Audio setup for theme toggle sound
  let audioContext: AudioContext | null = null;
  let audioBuffer: AudioBuffer | null = null;

  function initAudio() {
    const AudioContextClass =
      window.AudioContext || (window as any).webkitAudioContext;

    if (!AudioContextClass) {
      console.warn("Web Audio API is not supported in this browser.");
      return;
    }

    audioContext = new AudioContextClass();

    fetch("/audio/click.wav")
      .then((res) => res.arrayBuffer())
      .then((data) => audioContext!.decodeAudioData(data))
      .then((decoded) => {
        audioBuffer = decoded;
      })
      .catch((err) => {
        console.log("Failed to load click sound:", err);
      });
  }

  function playClickSound() {
    if (audioContext && audioBuffer) {
      const source = audioContext.createBufferSource();
      source.buffer = audioBuffer;
      source.connect(audioContext.destination);
      source.start(0);
    }
  }

  function updateIcons() {
    const isDark = document.documentElement.classList.contains("dark");
    const sunIcon = document.getElementById("sun-icon");
    const moonIcon = document.getElementById("moon-icon");

    if (sunIcon && moonIcon) {
      if (isDark) {
        // Dark mode: show moon, hide sun
        sunIcon.classList.add("rotate-90", "scale-0");
        sunIcon.classList.remove("rotate-0", "scale-100");
        moonIcon.classList.add("rotate-0", "scale-100");
        moonIcon.classList.remove("rotate-90", "scale-0");
      } else {
        // Light mode: show sun, hide moon
        sunIcon.classList.add("rotate-0", "scale-100");
        sunIcon.classList.remove("rotate-90", "scale-0");
        moonIcon.classList.add("rotate-90", "scale-0");
        moonIcon.classList.remove("rotate-0", "scale-100");
      }
    }
  }

  // Initialize audio
  initAudio();

  const button = document.getElementById("theme-toggle");

  const updateTheme = (theme: string) => {
    const isDark = theme === "dark";
    document.documentElement.classList[isDark ? "add" : "remove"]("dark");
    localStorage.setItem("theme", theme);

    // Update favicon based on theme
    const favicon = document.querySelector(
      "link[rel='icon']",
    ) as HTMLLinkElement;
    if (favicon) {
      favicon.href = isDark ? "/favicon-dark.ico" : "/favicon-light.ico";
    }

    // Update icons
    updateIcons();
  };

  const toggleTheme = () => {
    const currentTheme = document.documentElement.classList.contains("dark")
      ? "dark"
      : "light";
    const newTheme = currentTheme === "dark" ? "light" : "dark";
    playClickSound();
    updateTheme(newTheme);
  };

  // Set initial icon state
  updateIcons();

  button?.addEventListener("click", toggleTheme);

  // Re-attach event listener after navigation (for view transitions)
  document.addEventListener("astro:after-swap", () => {
    initAudio();
    updateIcons();
    const button = document.getElementById("theme-toggle");
    button?.addEventListener("click", toggleTheme);
  });
</script>
